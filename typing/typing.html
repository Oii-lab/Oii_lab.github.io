<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Oii_lab | Quiz Lab</title>

    <link rel="icon" type="image/png" href="../assets/images/oii.png" sizes="32x32">
    <link rel="stylesheet" href="../styles.css" /> 
    
    <style>
        /* ------------------- CSS 樣式優化 ------------------- */
        body { display: block; padding: 0; margin: 0; min-height: auto; font-family: 'Inter', sans-serif; }
        .content-section { max-width: 1200px; margin: 0 auto; padding: 100px 20px 40px 20px; }
        
        /* 保持 50/50 佈局 */
        .practice-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 30px; 
            background-color: var(--color-code-bg); 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.1); 
        }

        .panel.left { border-right: 1px solid rgba(255, 255, 255, 0.1); padding-right: 30px; }
        .panel.right { padding-left: 30px; }
        .panel h2 { color: var(--color-accent); font-size: 1.5em; margin-bottom: 20px; text-shadow: 0 0 5px rgba(0, 255, 255, 0.5); }
        
        textarea { 
            width: 100%; 
            min-height: 150px; 
            padding: 15px; 
            margin-bottom: 10px; 
            background-color: #212121; 
            color: var(--color-text-light); 
            border: 1px solid rgba(0, 255, 255, 0.4); 
            border-radius: 8px; 
            resize: vertical; 
            font-family: 'Inter', sans-serif;
        }
        
        .btn-group .btn { 
            display: inline-block; 
            padding: 10px 18px; 
            border: 2px solid var(--color-accent); 
            background-color: transparent; 
            color: var(--color-accent); 
            font-weight: 700; 
            letter-spacing: 1px; 
            transition: all 0.3s; 
            cursor: pointer; 
            border-radius: 8px; 
        }
        .btn-group .btn:hover { background-color: var(--color-accent); color: var(--color-bg-dark); box-shadow: 0 0 15px var(--color-accent); }
        .btn-group .btn.ghost { background: transparent; color: var(--color-accent); border: 2px solid rgba(0, 255, 255, 0.5); }

        /* 測驗區塊容器 */
        .quiz-box { 
            background: #1A1A1A; 
            border: 1px solid rgba(0, 255, 255, 0.3); 
            padding: 20px; 
            border-radius: 8px; 
            margin-top: 15px; 
            min-height: 200px;
        }
        .quiz-sentence { color: var(--color-text-light); font-size: 1.2em; margin-bottom: 15px; }
        
        /* 選擇題樣式 */
        .mcq-option { 
            display: block; 
            background: #252525; 
            padding: 12px 15px; 
            margin-bottom: 10px; 
            border-radius: 6px; 
            cursor: pointer; 
            transition: 0.2s; 
            border: 1px solid transparent; 
            color: var(--color-text-light);
        }
        .mcq-option:hover { background: #333; border-color: var(--color-accent); }
        .mcq-option input { margin-right: 12px; transform: scale(1.2); }

        /* 填空題樣式 (保留原本) */
        .blank-input { 
            background-color: #0d0d0d; 
            color: var(--color-text-light); 
            border: 1px solid rgba(0, 255, 255, 0.6); 
            padding: 5px 10px; 
            margin-right: 8px; 
            border-radius: 4px;
            width: auto;
            min-width: 120px;
        }
        
        .success { color: #00FF00; font-weight: bold; }
        .error { color: #FF4444; font-weight: bold; }
        .progress { color: #888; margin-top: 15px; font-size: 0.9em; }
        .small { color: #888; font-size: 0.85em; margin-bottom: 10px; line-height: 1.4; }

        @media (max-width: 1024px) { 
            .practice-grid { grid-template-columns: 1fr; } 
            .panel.left { border-right: none; border-bottom: 1px solid rgba(255, 255, 255, 0.1); padding-bottom: 30px; }
            .panel.right { padding-left: 0; padding-top: 30px; }
        }
    </style>
</head>
<body>
    <header class="navbar">
        <div class="container nav-content">
            <a href="../index.html" class="logo">Oii Lab</a> 
            <nav class="nav-links">
                <a href="#notes">最新筆記</a>
                <a href="typing.html">Quiz Lab</a>
                <a href="https://www.youtube.com/@Oii_lab" target="_blank" rel="noopener noreferrer">C++ Shorts</a>
            </nav>
        </div>
    </header>
    
    <div class="content-section"> 
        <div class="practice-grid">
            
            <div class="panel left">
                <h2>選擇題測驗模式</h2>
                <div class="small">
                    每行一題。格式：題目 | A:選項1 | B:選項2 | 答案:A<br>
                    (多選題格式：答案:A,B)
                </div>
                <textarea id="mcqData">1. 哪些是 C++ 關鍵字？ | A: int | B: float | C: apple | 答案: A,B
2. 1+1 等於多少？ | A: 1 | B: 2 | C: 3 | 答案: B
3. 何者不是程式語言？ | A: HTML | B: Python | C: Java | 答案: A</textarea>
                
                <div class="btn-group" style="display:flex; gap:8px;">
                    <button class="btn" onclick="loadMCQ()">匯入選擇題</button>
                    <button class="btn ghost" id="mcqNextBtn" onclick="goNextMCQ()">下一題</button>
                </div>

                <div id="mcqBox" class="quiz-box" style="display:none;">
                    <div id="mcqQuestion" class="quiz-sentence"></div>
                    <div id="mcqOptions"></div>
                    <button class="btn" style="width:100%; margin-top:15px;" onclick="checkMCQ()">提交答案</button>
                    <div id="mcqResult" style="margin-top:10px;"></div>
                    <div id="mcqProgress" class="progress"></div>
                </div>
            </div>

            <div class="panel right">
                <h2>填空小考模式</h2>
                <div class="small">
                    答案用方括號 [ ] 包住。建議匯入前加上題號！<br>
                    範例：I love [Oii Lab].
                </div>
                <textarea id="quizData">1. I have an [apple].
2. Networking improves [communication].
3. This is a [very] [important] lesson.</textarea>

                <div class="btn-group" style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
                    <button class="btn" id="loadQuizBtn">匯入題庫</button>
                    <button class="btn ghost" id="toggleOrderBtn">順序出題（目前：隨機）</button>
                    <button class="btn ghost" id="autoNextBtn">答對自動下一題（關）</button>
                </div>

                <div class="quiz-box">
                    <div id="quizSentence" class="quiz-sentence">尚未匯入題庫</div>
                    <div id="quizInputs"></div>
                    <div class="btn-group" style="display:flex;gap:8px;margin-top:10px">
                        <button class="btn" id="startQuizBtn">開始出題</button>
                        <button class="btn ghost" id="nextQuizBtn">下一題</button>
                    </div>
                    <div id="blankResult" style="margin-top:10px;"></div>
                    <div id="quizProgress" class="progress"></div>
                </div>
            </div>

        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 Oii_lab. All rights reserved.</p>
            <br>
            <a href="https://www.stylemap.co.jp/counter/taiwan/"><img src="https://www.f-counter.net/j/66/1764906602/" alt="網站計數器"></a>
        </div>
    </footer>

    <script>
        // ---------- 1. 填空小考邏輯 (完全保留原始功能) ----------
        const loadQuizBtn = document.getElementById('loadQuizBtn');
        const startQuizBtn = document.getElementById('startQuizBtn');
        const nextQuizBtn = document.getElementById('nextQuizBtn');
        const toggleOrderBtn = document.getElementById('toggleOrderBtn');
        const autoNextBtn = document.getElementById('autoNextBtn');
        const quizSentenceEl = document.getElementById('quizSentence');
        const quizInputsEl = document.getElementById('quizInputs');
        const blankResultEl = document.getElementById('blankResult');
        const quizProgressEl = document.getElementById('quizProgress');

        let quizList = [];
        let currentIndex = 0;
        let randomOrder = true;
        let autoNext = false;
        let orderList = [];

        loadQuizBtn.addEventListener('click', loadQuiz);
        startQuizBtn.addEventListener('click', startBlankQuiz);
        nextQuizBtn.addEventListener('click', goNextQuiz);
        toggleOrderBtn.addEventListener('click', ()=>{
            randomOrder = !randomOrder;
            toggleOrderBtn.textContent = randomOrder? '順序出題（目前：隨機）':'順序出題（目前：依序）';
        });
        autoNextBtn.addEventListener('click', ()=>{
            autoNext = !autoNext;
            autoNextBtn.textContent = autoNext? '答對自動下一題（開）':'答對自動下一題（關）';
        });

        function loadQuiz(){
            const raw = document.getElementById('quizData').value.trim();
            if(!raw){ alert('請輸入題庫！'); return; }
            quizList = raw.split(/\r?\n+/).map(line => {
                const answers = [];
                const regex = /\[(.+?)\]/g;
                let m;
                while((m = regex.exec(line)) !== null) answers.push(m[1].trim());
                if(answers.length===0) return null;
                return { raw: line, template: line.replace(/\[(.+?)\]/g, '____'), answers };
            }).filter(Boolean);
            if(quizList.length===0){ alert('匯入失敗！'); return; }
            orderList = quizList.map((_,i)=>i);
            if(randomOrder) shuffle(orderList);
            currentIndex = 0;
            updateProgress();
            alert('題庫匯入成功，共 ' + quizList.length + ' 題');
        }

        function startBlankQuiz(){
            if(quizList.length===0){ alert('請先匯入題庫！'); return; }
            const idx = orderList[currentIndex % orderList.length];
            renderQuiz(quizList[idx]);
            blankResultEl.textContent = '';
        }

        function renderQuiz(q){
            quizSentenceEl.textContent = q.template;
            quizInputsEl.innerHTML = '';
            q.answers.forEach((ans,i)=>{
                const input = document.createElement('input');
                input.type = 'text'; input.className = 'blank-input';
                input.placeholder = '答案 ' + (i+1);
                input.dataset.answer = ans;
                input.addEventListener('input', ()=>checkBlank(q));
                quizInputsEl.appendChild(input);
            });
            quizInputsEl.querySelector('input')?.focus(); 
        }

        function checkBlank(q){
            const inputs = Array.from(quizInputsEl.querySelectorAll('input'));
            const allCorrect = inputs.every(inp => inp.value.trim().toLowerCase() === (inp.dataset.answer||'').toLowerCase());
            if(allCorrect){
                blankResultEl.innerHTML = '<span class="success">✔ 正確！</span>';
                inputs.forEach(i=>i.disabled=true);
                if(autoNext) setTimeout(goNextQuiz, 800);
            } else { blankResultEl.textContent = ''; }
        }

        function goNextQuiz(){
            if(quizList.length===0) return;
            currentIndex = (currentIndex + 1) % orderList.length;
            startBlankQuiz();
            updateProgress();
        }

        function updateProgress(){
            if(quizList.length === 0) return;
            quizProgressEl.textContent = '填空進度：第 ' + (currentIndex+1) + ' 題 / 共 ' + quizList.length + ' 題';
        }

        function shuffle(arr){
            for(let i=arr.length-1;i>0;i--){
                const j = Math.floor(Math.random()*(i+1));
                [arr[i],arr[j]]=[arr[j],arr[i]];
            }
            return arr;
        }

        // ---------- 2. 選擇題邏輯 (左側面板) ----------
        let mcqList = [], mcqIdx = 0;

        function loadMCQ(){
            const raw = document.getElementById('mcqData').value.trim();
            if(!raw) return alert('請輸入選擇題題庫！');
            mcqList = raw.split('\n').map(line => {
                const parts = line.split('|').map(s => s.trim());
                const question = parts[0];
                const ansPart = parts.find(p => p.startsWith('答案:'));
                if(!ansPart) return null;
                const correct = ansPart.replace('答案:', '').trim().split(',').map(s => s.trim());
                const options = parts.filter(p => p.includes(':') && !p.startsWith('答案:')).map(p => {
                    const [key, val] = p.split(':');
                    return { key: key.trim(), text: val.trim() };
                });
                return { question, options, correct, isMulti: correct.length > 1 };
            }).filter(Boolean);
            
            if(mcqList.length) {
                document.getElementById('mcqBox').style.display = 'block';
                mcqIdx = 0; renderMCQ();
                alert(`選擇題匯入成功，共 ${mcqList.length} 題`);
            }
        }

        function renderMCQ(){
            const q = mcqList[mcqIdx % mcqList.length];
            document.getElementById('mcqQuestion').textContent = q.question + (q.isMulti ? " (多選)" : " (單選)");
            const container = document.getElementById('mcqOptions');
            container.innerHTML = ''; 
            document.getElementById('mcqResult').textContent = '';
            
            q.options.forEach(opt => {
                const label = document.createElement('label');
                label.className = 'mcq-option';
                label.innerHTML = `<input type="${q.isMulti ? 'checkbox' : 'radio'}" name="mcq" value="${opt.key}"> ${opt.key}: ${opt.text}`;
                container.appendChild(label);
            });
            document.getElementById('mcqProgress').textContent = `選擇題進度：第 ${mcqIdx+1} / ${mcqList.length} 題`;
        }

        function checkMCQ(){
            const q = mcqList[mcqIdx % mcqList.length];
            const selected = Array.from(document.querySelectorAll('input[name="mcq"]:checked')).map(i => i.value);
            if(!selected.length) return alert('請選擇答案');
            const isCorrect = selected.sort().join(',') === q.correct.sort().join(',');
            const res = document.getElementById('mcqResult');
            if(isCorrect){
                res.innerHTML = '<span class="success">✔ 回答正確！</span>';
                setTimeout(goNextMCQ, 1000);
            } else {
                res.innerHTML = `<span class="error">✘ 錯誤！正確答案是: ${q.correct.join(',')}</span>`;
            }
        }

        function goNextMCQ(){ 
            if(!mcqList.length) return;
            mcqIdx = (mcqIdx + 1) % mcqList.length; 
            renderMCQ(); 
        }

        // 初始化
        loadQuiz(); 
    </script>
</body>
</html>
